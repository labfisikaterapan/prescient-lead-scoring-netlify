<!DOCTYPE html>
<html lang="id" class="dark">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Prescient - Predictive Lead Scoring</title>
    
    <!-- Libraries (CDN) -->
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.2/dist/chart.umd.min.js"></script>
    
    <!-- Fonts: Outfit & Plus Jakarta Sans -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Outfit:wght@400;500;600;700&family=Plus+Jakarta+Sans:wght@400;500;600;700&display=swap" rel="stylesheet">
    
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css" />

    <!-- Tailwind Config -->
    <script>
        tailwind.config = {
            darkMode: 'class',
            theme: {
                extend: {
                    fontFamily: {
                        sans: ['"Plus Jakarta Sans"', 'sans-serif'],
                        heading: ['"Outfit"', 'sans-serif'],
                    },
                    colors: {
                        dark: {
                            bg: '#050507',
                            card: '#0f1014',
                            border: '#1f2128',  
                            input: '#16181d',   
                            surface: '#131419'
                        },
                        brand: {
                            primary: '#6366f1', // Indigo
                            secondary: '#a855f7', // Purple
                            accent: '#06b6d4', // Cyan
                        }
                    },
                    animation: {
                        'fade-in': 'fadeIn 0.8s ease-out',
                        'float': 'float 6s ease-in-out infinite',
                    },
                    keyframes: {
                        fadeIn: {
                            '0%': { opacity: '0', transform: 'translateY(20px)' },
                            '100%': { opacity: '1', transform: 'translateY(0)' },
                        },
                        float: {
                            '0%, 100%': { transform: 'translateY(0)' },
                            '50%': { transform: 'translateY(-10px)' },
                        }
                    }
                }
            }
        }
    </script>

    <style>
        body {
            background-color: #050507;
            color: #e2e8f0;
            overflow-x: hidden;
            -webkit-tap-highlight-color: transparent;
        }

        /* --- HIGH PERFORMANCE VIDEO BACKGROUND --- */
        #bg-video-container {
            position: fixed;
            top: 0; left: 0; width: 100%; height: 100%;
            overflow: hidden;
            z-index: -2;
        }
        
        /* Dashboard Video Background - NEW APPROACH */
        #bg-video-dashboard {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            z-index: -10;
            overflow: hidden;
            display: none; /* Hidden by default, shown when dashboard active */
        }
        
        #bg-video-dashboard.active {
            display: block !important;
        }
        
        #bg-video-dashboard video {
            position: absolute;
            top: 50%;
            left: 50%;
            min-width: 100%;
            min-height: 100%;
            width: auto;
            height: auto;
            transform: translate(-50%, -50%);
            object-fit: cover;
        }
        
        /* Video Overlay for contrast */
        #bg-video-dashboard::after {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: linear-gradient(135deg, rgba(0,0,0,0.7) 0%, rgba(0,0,0,0.5) 50%, rgba(0,0,0,0.7) 100%);
            pointer-events: none;
            z-index: 1;
        }

        #bg-video, #dashboard-video {
            min-width: 100%; 
            min-height: 100%; 
            width: auto; 
            height: auto;
            position: absolute;
            top: 50%; left: 50%;
            transform: translate(-50%, -50%) translate3d(0, 0, 0); /* Force GPU Acceleration */
            object-fit: cover;
            /* Filter untuk membuat video sedikit lebih gelap agar teks terbaca, tapi tetap vibrant */
            filter: brightness(0.8) contrast(1.1); 
            will-change: transform; /* Hint to browser for optimization */
            opacity: 0;
            transition: opacity 1s ease-in-out; /* Smooth fade in */
        }

        #bg-video.loaded, #dashboard-video.loaded {
            opacity: 1;
        }

        .video-fallback {
            position: absolute; top: 0; left: 0; width: 100%; height: 100%;
            background: radial-gradient(circle at center, #1e1b4b 0%, #000000 100%);
            z-index: -3;
        }

        /* --- TABLE ROW TRANSITIONS --- */
        table tbody tr {
            transition: all 0.3s ease-out;
        }

        /* Styling untuk baris dengan status 'done' */
        table tbody tr.opacity-50 {
            background-color: rgba(0, 0, 0, 0.3);
        }

        table tbody tr.grayscale {
            filter: grayscale(0.5) brightness(0.8);
        }

        table tbody tr.opacity-50:hover {
            background-color: rgba(255, 255, 255, 0.03) !important;
        }

        /* Legacy class untuk backward compatibility */
        table tbody tr.opacity-40 {
            background-color: rgba(0, 0, 0, 0.3);
            filter: grayscale(0.3);
        }

        table tbody tr.opacity-40:hover {
            background-color: rgba(255, 255, 255, 0.03) !important;
        }

        /* --- TOAST CONTAINER --- */
        #toast-container {
            pointer-events: none;
        }

        #toast-container > div {
            pointer-events: auto;
        }

        /* --- GLASSMORPHISM --- */
        .glass-card {
            background: rgba(10, 10, 15, 0.4); 
            border: 1px solid rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(16px); 
            -webkit-backdrop-filter: blur(16px);
            box-shadow: 0 8px 32px 0 rgba(0, 0, 0, 0.37);
        }

        .dashboard-glass {
            background: rgba(15, 16, 20, 0.75); /* More transparent */
            backdrop-filter: blur(24px) saturate(180%);
            -webkit-backdrop-filter: blur(24px) saturate(180%);
            border: 1px solid rgba(255, 255, 255, 0.08);
        }
        
        /* Dashboard cards with glassmorphism */
        #dashboard-container .dashboard-glass {
            background: rgba(10, 10, 15, 0.6);
            backdrop-filter: blur(20px) saturate(150%);
            -webkit-backdrop-filter: blur(20px) saturate(150%);
            border: 1px solid rgba(255, 255, 255, 0.1);
            box-shadow: 0 8px 32px 0 rgba(0, 0, 0, 0.37);
        }

        /* --- INPUTS --- */
        .premium-input {
            background: rgba(0, 0, 0, 0.3);
            border: 1px solid rgba(255, 255, 255, 0.1);
            transition: all 0.3s ease;
            color: white;
        }
        .premium-input:focus {
            background: rgba(0, 0, 0, 0.6);
            border-color: #6366f1;
            box-shadow: 0 0 15px rgba(99, 102, 241, 0.3);
            outline: none;
        }
        .premium-input::placeholder {
            color: rgba(255, 255, 255, 0.4);
        }

        /* --- UTILS --- */
        .page-section { display: none; }
        .page-section.active { display: block; animation: fadeIn 0.6s cubic-bezier(0.22, 1, 0.36, 1); }
        .sidebar-mobile { transition: transform 0.3s ease-in-out; }
        * { -webkit-font-smoothing: antialiased; -moz-osx-font-smoothing: grayscale; }
    </style>
</head>
<body class="font-sans text-sm md:text-base selection:bg-brand-primary selection:text-white">

    <!-- LIVE WALLPAPER CONTAINER -->
    <div id="bg-video-container">
        <div class="video-fallback"></div>
        <video autoplay muted loop playsinline preload="auto" id="bg-video">
            <source src="/static/universe-effects.1920x1080.mp4" type="video/mp4">
        </video>
        <div class="absolute inset-0 bg-black/30 z-[-1]"></div>
    </div>

    <!-- LOGIN / AUTH SECTION -->
    <main id="auth-container" class="relative w-full min-h-screen flex items-center justify-center p-4">
        
        <!-- Login Card (Transparent Glass) -->
        <div id="login-view" class="glass-card relative z-10 w-full max-w-5xl h-auto md:min-h-[600px] rounded-3xl flex flex-col md:flex-row overflow-hidden animate-fade-in border border-white/10">
            
            <!-- Left Side: Form -->
            <div class="w-full md:w-1/2 p-8 md:p-12 flex flex-col justify-center relative z-20">
                
                <!-- Logo -->
                <div class="flex items-center gap-2 mb-8 md:mb-12">
                    <div class="w-8 h-8 rounded-lg bg-white/10 flex items-center justify-center text-white shadow-lg backdrop-blur-sm border border-white/20">
                        <i class="fas fa-cube text-xs"></i>
                    </div>
                    <span class="font-heading font-bold text-lg tracking-wide text-white drop-shadow-md">PRESCIENT</span>
                </div>

                <div class="mb-8">
                    <!-- Updated Text Gradient & Shadow for Clarity -->
                    <h1 class="font-heading text-4xl md:text-5xl font-bold text-white mb-3 drop-shadow-[0_4px_4px_rgba(0,0,0,0.8)]">
                        Welcome <span class="text-transparent bg-clip-text bg-gradient-to-r from-brand-primary via-brand-secondary to-brand-accent drop-shadow-[0_2px_10px_rgba(99,102,241,0.8)]">Back</span>
                    </h1>
                    <p class="text-gray-200 font-light text-lg drop-shadow-md">
                        Masuk untuk mengakses dashboard prediksi.
                    </p>
                </div>

                <!-- Form -->
                <form id="login-form" class="space-y-5">
                    <div id="login-error" class="hidden flex items-center gap-2 text-red-200 text-sm bg-red-500/20 p-3 rounded-lg border border-red-500/30 animate-pulse backdrop-blur-sm">
                        <i class="fas fa-circle-exclamation"></i> Username/Password salah.
                    </div>

                    <div class="space-y-1.5">
                        <label class="text-xs font-bold text-gray-300 uppercase tracking-wider ml-1 drop-shadow-sm">Username</label>
                        <div class="relative">
                            <i class="fas fa-user absolute left-4 top-1/2 -translate-y-1/2 text-gray-400 text-xs"></i>
                            <input type="text" id="username" placeholder="Cth: eiz" 
                                class="premium-input w-full rounded-xl pl-10 pr-5 py-3.5 text-white focus:outline-none focus:bg-black/60 shadow-inner">
                        </div>
                    </div>

                    <!-- Password Field with Toggle -->
                    <div class="space-y-1.5">
                        <label class="text-xs font-bold text-gray-300 uppercase tracking-wider ml-1 drop-shadow-sm">Password</label>
                        <div class="relative">
                            <i class="fas fa-lock absolute left-4 top-1/2 -translate-y-1/2 text-gray-400 text-xs"></i>
                            <input type="password" id="password" placeholder="‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢" 
                                class="premium-input w-full rounded-xl pl-10 pr-10 py-3.5 text-white focus:outline-none focus:bg-black/60 shadow-inner">
                            <button type="button" id="toggle-login-password" class="absolute right-4 top-1/2 -translate-y-1/2 text-gray-400 hover:text-white transition-colors focus:outline-none">
                                <i class="fas fa-eye"></i>
                            </button>
                        </div>
                    </div>

                    <div class="flex items-center justify-between pt-1">
                        <label class="flex items-center space-x-2 cursor-pointer group select-none">
                            <div class="relative">
                                <input type="checkbox" class="peer sr-only" />
                                <div class="w-4 h-4 rounded border border-gray-400 bg-transparent peer-checked:bg-brand-primary peer-checked:border-brand-primary transition-all shadow-sm"></div>
                                <i class="fas fa-check absolute top-1/2 left-1/2 -translate-x-1/2 -translate-y-1/2 text-[10px] text-white opacity-0 peer-checked:opacity-100 transition-opacity"></i>
                            </div>
                            <span class="text-xs text-gray-300 group-hover:text-white transition-colors drop-shadow-sm">Ingat saya</span>
                        </label>
                        <a href="#" id="forgot-pass-link" class="text-xs font-medium text-brand-primary hover:text-white hover:underline transition-all drop-shadow-sm">Lupa Password?</a>
                    </div>

                    <button type="submit" class="w-full bg-brand-primary hover:bg-indigo-500 text-white font-heading font-bold tracking-wide py-4 rounded-xl shadow-[0_0_20px_rgba(99,102,241,0.5)] transition-all active:scale-95 mt-4 border border-indigo-400/20 hover:shadow-[0_0_30px_rgba(99,102,241,0.6)]">
                        SIGN IN
                    </button>
                </form>

                <div class="mt-8 pt-6 border-t border-white/10 text-center md:text-left">
                    <p class="text-xs text-gray-300 drop-shadow-sm">
                        Belum punya akun? <a href="#" id="to-register-link" class="text-white font-bold hover:text-brand-primary transition-colors underline decoration-brand-primary decoration-2 underline-offset-4">Daftar Sekarang</a>
                    </p>
                </div>
            </div>

            <!-- Right Side: Visual Image (Original Pinterest) -->
            <div class="hidden md:flex w-1/2 relative items-center justify-center overflow-hidden border-l border-white/5 group">
                <img src="https://i.pinimg.com/736x/d9/6c/55/d96c55976b0c2103e3560e7096c62801.jpg" 
                     alt="Prescient Visual" 
                     class="absolute inset-0 w-full h-full object-cover transition-transform duration-700 ease-in-out group-hover:scale-110 opacity-90">
                <!-- Optional: Thin Overlay for consistency -->
                <div class="absolute inset-0 bg-black/10 group-hover:bg-transparent transition-colors duration-500"></div>
            </div>
        </div>

        <!-- Register View -->
        <div id="register-view" class="hidden glass-card relative z-20 w-full max-w-md p-8 rounded-3xl animate-fade-in mx-4">
            <div class="text-center mb-6 mt-2">
                <div class="w-14 h-14 bg-white/10 rounded-2xl flex items-center justify-center mx-auto mb-4 backdrop-blur-md border border-white/20 shadow-lg">
                    <i class="fas fa-user-plus text-2xl text-white"></i>
                </div>
                <h2 class="font-heading text-2xl font-bold text-white drop-shadow-md">Daftar Akun</h2>
                <p class="text-gray-300 text-sm mt-1">Buat akun baru untuk memulai perjalanan Anda.</p>
            </div>
            
            <form id="register-form" class="space-y-4">
                <div class="space-y-1.5">
                    <label class="text-xs font-bold text-gray-300 uppercase tracking-wider ml-1">Email (Gmail)</label>
                    <div class="relative">
                        <i class="fas fa-envelope absolute left-4 top-1/2 -translate-y-1/2 text-gray-400 text-xs"></i>
                        <input type="email" id="reg-email" required placeholder="nama@gmail.com" 
                            class="premium-input w-full rounded-xl pl-10 pr-5 py-3 text-white focus:outline-none">
                    </div>
                </div>
                <div class="space-y-1.5">
                    <label class="text-xs font-bold text-gray-300 uppercase tracking-wider ml-1">Username</label>
                    <div class="relative">
                        <i class="fas fa-user absolute left-4 top-1/2 -translate-y-1/2 text-gray-400 text-xs"></i>
                        <input type="text" id="reg-username" required placeholder="Username" 
                            class="premium-input w-full rounded-xl pl-10 pr-5 py-3 text-white focus:outline-none">
                    </div>
                </div>
                <!-- Register Password Field with Toggle -->
                <div class="space-y-1.5">
                    <label class="text-xs font-bold text-gray-300 uppercase tracking-wider ml-1">Password</label>
                    <div class="relative">
                        <i class="fas fa-lock absolute left-4 top-1/2 -translate-y-1/2 text-gray-400 text-xs"></i>
                        <input type="password" id="reg-password" required placeholder="‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢" 
                            class="premium-input w-full rounded-xl pl-10 pr-10 py-3 text-white focus:outline-none">
                        <button type="button" id="toggle-reg-password" class="absolute right-4 top-1/2 -translate-y-1/2 text-gray-400 hover:text-white transition-colors focus:outline-none">
                            <i class="fas fa-eye"></i>
                        </button>
                    </div>
                </div>
                
                <button type="submit" class="w-full bg-brand-primary hover:bg-indigo-500 text-white font-bold py-3.5 rounded-xl mt-4 transition-all shadow-[0_0_15px_rgba(99,102,241,0.4)] border border-indigo-400/20">
                    Daftar Akun
                </button>
            </form>
            <div class="mt-6 pt-4 border-t border-white/10 text-center">
                <p class="text-xs text-gray-300">
                    Sudah punya akun? <a href="#" id="to-login-link" class="text-white hover:text-brand-primary font-bold transition-colors underline decoration-brand-primary underline-offset-4">Masuk</a>
                </p>
            </div>
        </div>

        <!-- Forgot Password View (Updated Gradient) -->
        <div id="forgot-view" class="hidden glass-card relative z-20 w-full max-w-md p-8 rounded-3xl animate-fade-in mx-4">
            <button class="back-to-login absolute top-4 left-4 text-gray-300 hover:text-white transition-colors w-8 h-8 flex items-center justify-center rounded-full hover:bg-white/10">
                <i class="fas fa-arrow-left"></i>
            </button>
            
            <div class="text-center mb-6 mt-2">
                <!-- Icon with Gradient Background -->
                <div class="w-16 h-16 bg-gradient-to-br from-brand-secondary/20 to-brand-primary/20 rounded-2xl flex items-center justify-center mx-auto mb-4 backdrop-blur-md border border-brand-secondary/30 shadow-[0_0_15px_rgba(168,85,247,0.2)]">
                    <i class="fas fa-key text-3xl text-purple-400 drop-shadow-md"></i>
                </div>
                <!-- Gradient Text Title -->
                <h2 class="font-heading text-2xl font-bold text-transparent bg-clip-text bg-gradient-to-r from-brand-secondary via-purple-400 to-brand-primary drop-shadow-sm mb-1">
                    Reset Akses
                </h2>
                <p class="text-gray-300 text-sm">Masukkan email terdaftar Anda.</p>
            </div>
            
            <form id="forgot-form" class="space-y-5">
                <div class="relative">
                    <i class="fas fa-envelope absolute left-4 top-1/2 -translate-y-1/2 text-gray-400 text-xs"></i>
                    <input type="email" id="forgot-email" required placeholder="your-email@gmail.com" 
                        class="premium-input w-full rounded-xl pl-10 pr-5 py-3.5 text-white focus:outline-none focus:border-purple-500/50 focus:bg-black/40">
                </div>
                
                <!-- Enhanced Gradient Button -->
                <button type="submit" class="w-full bg-gradient-to-r from-brand-secondary to-purple-600 hover:from-purple-500 hover:to-brand-secondary text-white font-heading font-bold tracking-wide py-3.5 rounded-xl mt-2 transition-all shadow-[0_0_25px_rgba(168,85,247,0.3)] border border-purple-400/30 active:scale-95">
                    Kirim Instruksi
                </button>
            </form>
        </div>
    </main>

    <!-- DASHBOARD VIDEO BACKGROUND -->
    <div id="bg-video-dashboard">
        <video autoplay muted loop playsinline preload="auto">
            <source src="/static/blue-forest-waterfalls.1920x1080.mp4" type="video/mp4">
        </video>
    </div>

    <!-- DASHBOARD SECTION -->
    <div id="dashboard-container" class="hidden min-h-screen bg-transparent flex text-gray-200 font-sans relative">
        <!-- Removed solid background, video will show through -->

        <header class="md:hidden fixed top-0 left-0 w-full h-16 bg-dark-card/90 backdrop-blur-md border-b border-dark-border flex items-center justify-between px-4 z-50">
            <div class="flex items-center gap-2">
                <div class="w-6 h-6 rounded bg-brand-primary flex items-center justify-center text-white">
                    <i class="fas fa-cube text-[10px]"></i>
                </div>
                <span class="font-heading font-bold text-white">Prescient</span>
            </div>
            <button id="mobile-menu-btn" class="text-gray-300 hover:text-white p-2">
                <i class="fas fa-bars text-xl"></i>
            </button>
        </header>

        <div id="sidebar-overlay" class="md:hidden fixed inset-0 bg-black/50 z-40 hidden backdrop-blur-sm transition-opacity"></div>

        <aside id="sidebar" class="fixed md:sticky top-0 left-0 h-screen w-64 dashboard-glass border-r border-dark-border flex flex-col z-50 transform -translate-x-full md:translate-x-0 sidebar-mobile">
            <button id="close-sidebar" class="md:hidden absolute top-4 right-4 text-gray-400">
                <i class="fas fa-times"></i>
            </button>

            <div class="p-6">
                <div class="flex items-center gap-3 mb-8">
                    <div class="w-8 h-8 rounded-lg bg-gradient-to-br from-brand-primary to-brand-accent flex items-center justify-center text-white font-bold text-sm shadow-lg shadow-brand-primary/20">
                        P
                    </div>
                    <span class="font-heading font-bold text-lg text-white tracking-wide">Prescient</span>
                </div>

                <div class="text-xs font-bold text-gray-500 uppercase tracking-wider mb-4 px-2">Menu Utama</div>
                
                <nav class="space-y-1">
                    <a href="#dashboard" class="nav-item active flex items-center gap-3 px-4 py-3 rounded-xl text-gray-400 hover:bg-white/5 hover:text-white transition-all group">
                        <i class="fas fa-chart-pie w-5 group-hover:text-brand-primary transition-colors"></i>
                        <span class="font-medium">Dashboard</span>
                    </a>
                    <a href="#prediksi" class="nav-item flex items-center gap-3 px-4 py-3 rounded-xl text-gray-400 hover:bg-white/5 hover:text-white transition-all group">
                        <i class="fas fa-brain w-5 group-hover:text-green-400 transition-colors"></i>
                        <span class="font-medium">Prediksi Lead</span>
                        <span class="ml-auto text-[10px] bg-green-400/10 text-green-400 px-2 py-0.5 rounded-full font-bold">AI</span>
                    </a>
                    <a href="#prospek" class="nav-item flex items-center gap-3 px-4 py-3 rounded-xl text-gray-400 hover:bg-white/5 hover:text-white transition-all group">
                        <i class="fas fa-users w-5 group-hover:text-brand-accent transition-colors"></i>
                        <span class="font-medium">Data Prospek</span>
                        <span class="ml-auto text-[10px] bg-brand-accent/10 text-brand-accent px-2 py-0.5 rounded-full font-bold">LIVE</span>
                    </a>
                    <a href="#analisis" class="nav-item flex items-center gap-3 px-4 py-3 rounded-xl text-gray-400 hover:bg-white/5 hover:text-white transition-all group">
                        <i class="fas fa-book-open w-5 group-hover:text-brand-secondary transition-colors"></i>
                        <span class="font-medium">Panduan</span>
                    </a>
                    <a href="#tentang" class="nav-item flex items-center gap-3 px-4 py-3 rounded-xl text-gray-400 hover:bg-white/5 hover:text-white transition-all group">
                        <i class="fas fa-info-circle w-5 group-hover:text-white transition-colors"></i>
                        <span class="font-medium">Tentang</span>
                    </a>
                </nav>
            </div>

            <div class="mt-auto p-6 border-t border-white/5">
                <button id="logout-btn" class="w-full flex items-center justify-center gap-2 px-4 py-2.5 text-sm font-medium text-red-400 border border-red-500/10 hover:bg-red-500/10 rounded-lg transition-all">
                    <i class="fas fa-power-off"></i> Keluar
                </button>
            </div>
        </aside>

        <main class="flex-1 flex flex-col min-h-screen pt-16 md:pt-0 overflow-hidden relative">
            <div class="flex-1 overflow-y-auto p-4 md:p-8 relative scroll-smooth">
                
                <section id="page-dashboard" class="page-section active max-w-7xl mx-auto">
                    <header class="mb-6 md:mb-8">
                        <h2 class="font-heading text-2xl md:text-3xl font-bold text-white mb-1">Performance Overview</h2>
                        <p class="text-gray-400 text-sm">Real-time analysis of deposit campaign metrics.</p>
                    </header>

                    <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4 mb-6">
                        <div class="dashboard-glass p-5 rounded-xl border-l-4 border-l-brand-primary">
                            <p class="text-gray-400 text-xs font-bold uppercase mb-1">Total Nasabah</p>
                            <h3 class="font-heading text-2xl font-bold text-white" id="stat-total">1000</h3>
                            <div class="mt-2 text-xs flex items-center gap-1 text-green-400"><i class="fas fa-arrow-up"></i> <span id="stat-growth">12</span>% <span class="text-gray-500">bulan ini</span></div>
                        </div>
                        <div class="dashboard-glass p-5 rounded-xl border-l-4 border-l-brand-accent">
                            <p class="text-gray-400 text-xs font-bold uppercase mb-1">Hot Leads</p>
                            <h3 class="font-heading text-2xl font-bold text-white" id="stat-hot">200</h3>
                            <div class="mt-2 text-xs flex items-center gap-1 text-brand-accent"><i class="fas fa-fire"></i> High Priority</div>
                        </div>
                        <div class="dashboard-glass p-5 rounded-xl border-l-4 border-l-brand-secondary">
                            <p class="text-gray-400 text-xs font-bold uppercase mb-1">Konversi AI</p>
                            <h3 class="font-heading text-2xl font-bold text-white"><span id="stat-conversion">18.5</span>%</h3>
                            <div class="mt-2 text-xs flex items-center gap-1 text-green-400"><i class="fas fa-check"></i> +7.3% vs Manual</div>
                        </div>
                         <div class="dashboard-glass p-5 rounded-xl border-l-4 border-l-purple-500">
                            <p class="text-gray-400 text-xs font-bold uppercase mb-1">Warm Leads</p>
                            <h3 class="font-heading text-2xl font-bold text-white" id="stat-warm">350</h3>
                            <div class="mt-2 text-xs flex items-center gap-1 text-purple-400"><i class="fas fa-star"></i> Medium Priority</div>
                        </div>
                    </div>

                    <div class="grid grid-cols-1 lg:grid-cols-3 gap-6 mb-8">
                        <div class="lg:col-span-2 dashboard-glass p-5 rounded-xl">
                            <div class="flex justify-between items-center mb-4"><h3 class="font-heading font-bold text-white text-base">Distribusi Lead</h3></div>
                            <div class="chart-container relative h-64 w-full"><canvas id="scoreChart"></canvas></div>
                        </div>
                        <div class="dashboard-glass p-5 rounded-xl">
                            <h3 class="font-heading font-bold text-white text-base mb-4">Faktor Utama</h3>
                            <div class="space-y-4">
                                <div class="group">
                                    <div class="flex justify-between text-xs mb-1"><span class="text-gray-300">Durasi Kontak</span><span class="text-white">92%</span></div>
                                    <div class="w-full bg-gray-800 rounded-full h-1.5 overflow-hidden"><div class="bg-brand-primary h-full rounded-full w-[92%]"></div></div>
                                </div>
                                <div class="group">
                                    <div class="flex justify-between text-xs mb-1"><span class="text-gray-300">Saldo Akun</span><span class="text-white">78%</span></div>
                                    <div class="w-full bg-gray-800 rounded-full h-1.5 overflow-hidden"><div class="bg-brand-secondary h-full rounded-full w-[78%]"></div></div>
                                </div>
                                <div class="group">
                                    <div class="flex justify-between text-xs mb-1"><span class="text-gray-300">Pekerjaan</span><span class="text-white">65%</span></div>
                                    <div class="w-full bg-gray-800 rounded-full h-1.5 overflow-hidden"><div class="bg-brand-accent h-full rounded-full w-[65%]"></div></div>
                                </div>
                            </div>
                        </div>
                    </div>
                </section>

                <!-- NEW: AI PREDICTION SECTION -->
                <section id="page-prediksi" class="page-section max-w-5xl mx-auto">
                    <header class="mb-6 md:mb-8">
                        <h2 class="font-heading text-2xl md:text-3xl font-bold text-white mb-1">ü§ñ Prediksi Lead Score</h2>
                        <p class="text-gray-400 text-sm">Gunakan AI untuk memprediksi conversion probability prospek baru.</p>
                    </header>

                    <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
                        <!-- LEFT: Input Form -->
                        <div class="dashboard-glass p-6 rounded-xl">
                            <h3 class="font-heading font-bold text-white text-lg mb-4 flex items-center gap-2">
                                <i class="fas fa-user-plus text-brand-primary"></i>
                                Input Data Prospek
                            </h3>
                            
                            <form id="predict-form" class="space-y-4">
                                <!-- Pekerjaan -->
                                <div>
                                    <label class="block text-xs font-bold text-gray-400 mb-1.5">Pekerjaan</label>
                                    <select id="input-job" required class="w-full bg-dark-card text-white text-sm rounded-lg px-3 py-2.5 focus:outline-none focus:ring-2 focus:ring-brand-primary border border-gray-700">
                                        <option value="">-- Pilih Pekerjaan --</option>
                                        <option value="management">Management</option>
                                        <option value="technician">Technician</option>
                                        <option value="admin.">Admin</option>
                                        <option value="services">Services</option>
                                        <option value="entrepreneur">Entrepreneur</option>
                                        <option value="blue-collar">Blue-collar</option>
                                        <option value="retired">Retired</option>
                                        <option value="unemployed">Unemployed</option>
                                        <option value="student">Student</option>
                                        <option value="housemaid">Housemaid</option>
                                        <option value="self-employed">Self-employed</option>
                                    </select>
                                </div>

                                <!-- Saldo -->
                                <div>
                                    <label class="block text-xs font-bold text-gray-400 mb-1.5">Saldo (EUR)</label>
                                    <input type="number" id="input-saldo" required step="0.01" placeholder="contoh: 1500" class="w-full bg-dark-card text-white text-sm rounded-lg px-3 py-2.5 focus:outline-none focus:ring-2 focus:ring-brand-primary border border-gray-700">
                                </div>

                                <!-- Personal Loan -->
                                <div>
                                    <label class="block text-xs font-bold text-gray-400 mb-1.5">Pinjaman Personal</label>
                                    <select id="input-personal-loan" required class="w-full bg-dark-card text-white text-sm rounded-lg px-3 py-2.5 focus:outline-none focus:ring-2 focus:ring-brand-primary border border-gray-700">
                                        <option value="">-- Pilih --</option>
                                        <option value="yes">Ya</option>
                                        <option value="no">Tidak</option>
                                    </select>
                                </div>

                                <!-- Housing Loan -->
                                <div>
                                    <label class="block text-xs font-bold text-gray-400 mb-1.5">Pinjaman Rumah</label>
                                    <select id="input-housing-loan" required class="w-full bg-dark-card text-white text-sm rounded-lg px-3 py-2.5 focus:outline-none focus:ring-2 focus:ring-brand-primary border border-gray-700">
                                        <option value="">-- Pilih --</option>
                                        <option value="yes">Ya</option>
                                        <option value="no">Tidak</option>
                                    </select>
                                </div>

                                <!-- Marital Status -->
                                <div>
                                    <label class="block text-xs font-bold text-gray-400 mb-1.5">Status Pernikahan</label>
                                    <select id="input-marital" required class="w-full bg-dark-card text-white text-sm rounded-lg px-3 py-2.5 focus:outline-none focus:ring-2 focus:ring-brand-primary border border-gray-700">
                                        <option value="">-- Pilih --</option>
                                        <option value="married">Menikah</option>
                                        <option value="single">Belum Menikah</option>
                                        <option value="divorced">Cerai</option>
                                    </select>
                                </div>

                                <!-- Campaign Count -->
                                <div>
                                    <label class="block text-xs font-bold text-gray-400 mb-1.5">Jumlah Campaign</label>
                                    <input type="number" id="input-campaign" required min="1" max="50" value="1" class="w-full bg-dark-card text-white text-sm rounded-lg px-3 py-2.5 focus:outline-none focus:ring-2 focus:ring-brand-primary border border-gray-700">
                                </div>

                                <!-- Duration (Important!) -->
                                <div>
                                    <label class="block text-xs font-bold text-gray-400 mb-1.5">
                                        Durasi Kontak (detik) 
                                        <span class="text-brand-primary">‚≠ê 92% Weight</span>
                                    </label>
                                    <input type="number" id="input-duration" required min="0" max="5000" placeholder="contoh: 300" class="w-full bg-dark-card text-white text-sm rounded-lg px-3 py-2.5 focus:outline-none focus:ring-2 focus:ring-brand-primary border border-gray-700">
                                </div>

                                <!-- Submit Button -->
                                <button type="submit" id="predict-btn" class="w-full bg-gradient-to-r from-brand-primary to-indigo-500 hover:from-indigo-600 hover:to-purple-600 text-white font-bold py-3 rounded-lg transition-all transform hover:scale-[1.02] flex items-center justify-center gap-2">
                                    <i class="fas fa-brain"></i>
                                    Prediksi Sekarang
                                </button>
                            </form>
                        </div>

                        <!-- RIGHT: Prediction Result -->
                        <div class="space-y-6">
                            <!-- Result Card -->
                            <div id="result-card" class="dashboard-glass p-6 rounded-xl hidden">
                                <h3 class="font-heading font-bold text-white text-lg mb-4 flex items-center gap-2">
                                    <i class="fas fa-chart-line text-green-400"></i>
                                    Hasil Prediksi
                                </h3>

                                <!-- Score Display -->
                                <div class="text-center mb-6">
                                    <div class="inline-flex items-center justify-center w-32 h-32 rounded-full bg-gradient-to-br from-brand-primary/20 to-brand-accent/20 border-4 border-brand-primary/50 mb-3">
                                        <div class="text-center">
                                            <div id="result-score" class="text-4xl font-bold text-white">--</div>
                                            <div class="text-xs text-gray-400">Score</div>
                                        </div>
                                    </div>
                                    <div id="result-label" class="text-2xl font-bold text-white mb-2">-</div>
                                    <div id="result-probability" class="text-sm text-gray-400">-</div>
                                </div>

                                <!-- Recommendation -->
                                <div class="bg-black/40 rounded-lg p-4 border border-white/10">
                                    <div class="text-xs font-bold text-gray-400 uppercase mb-2">üí° Rekomendasi</div>
                                    <p id="result-recommendation" class="text-sm text-gray-300 leading-relaxed">-</p>
                                </div>
                            </div>

                            <!-- Info Card -->
                            <div class="dashboard-glass p-6 rounded-xl">
                                <h4 class="font-bold text-white mb-3 flex items-center gap-2">
                                    <i class="fas fa-info-circle text-blue-400"></i>
                                    Faktor Penting
                                </h4>
                                <div class="space-y-3 text-sm text-gray-400">
                                    <div class="flex items-start gap-2">
                                        <i class="fas fa-clock text-brand-primary mt-0.5"></i>
                                        <div>
                                            <strong class="text-white">Durasi Kontak (92%)</strong><br>
                                            Semakin lama durasi kontak, semakin tinggi kemungkinan konversi.
                                        </div>
                                    </div>
                                    <div class="flex items-start gap-2">
                                        <i class="fas fa-wallet text-brand-secondary mt-0.5"></i>
                                        <div>
                                            <strong class="text-white">Saldo Akun (78%)</strong><br>
                                            Saldo tinggi mengindikasikan stabilitas finansial.
                                        </div>
                                    </div>
                                    <div class="flex items-start gap-2">
                                        <i class="fas fa-briefcase text-brand-accent mt-0.5"></i>
                                        <div>
                                            <strong class="text-white">Pekerjaan (65%)</strong><br>
                                            Management & Technician memiliki conversion rate lebih tinggi.
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </section>

                <section id="page-prospek" class="page-section max-w-7xl mx-auto">
                    <header class="mb-6 flex flex-col gap-4">
                        <div class="flex justify-between items-end">
                            <div><h2 class="font-heading text-2xl font-bold text-white mb-1">Daftar Prospek</h2><p class="text-gray-400 text-sm">Prioritas lead hari ini berdasarkan AI.</p></div>
                            <button onclick="downloadCSV()" class="hidden md:flex items-center gap-2 bg-brand-primary hover:bg-indigo-500 text-white text-xs font-bold py-2 px-4 rounded-lg transition-colors"><i class="fas fa-file-export"></i> Export CSV</button>
                        </div>
                        <div class="flex flex-col md:flex-row gap-2 dashboard-glass p-2 rounded-xl border border-dark-border justify-between items-center">
                            <div class="flex gap-2 w-full md:w-auto">
                                <input type="text" id="search-lead" placeholder="Cari nama..." class="bg-transparent text-white text-sm rounded-lg px-3 py-2 focus:outline-none w-full md:w-64 border border-gray-700 focus:border-brand-primary">
                                <select id="filter-score" class="bg-dark-card text-gray-300 text-sm rounded-lg px-3 py-2 focus:outline-none border border-gray-700">
                                    <option value="all">Semua Skor</option>
                                    <option value="hot">Hot Only</option>
                                    <option value="warm">Warm</option>
                                </select>
                            </div>
                            <div class="text-xs text-gray-400" id="pagination-info">Menampilkan 1-10 dari 100 data</div>
                        </div>
                    </header>

                    <div class="dashboard-glass rounded-xl overflow-hidden border border-white/5 flex flex-col">
                        <div class="overflow-x-auto">
                            <table class="w-full text-sm text-left whitespace-nowrap">
                                <thead class="text-xs text-gray-500 uppercase bg-black/20 font-bold">
                                    <tr>
                                        <th class="px-4 py-3">Nama</th>
                                        <th class="px-4 py-3">Pekerjaan</th>
                                        <th class="px-4 py-3">Saldo</th>
                                        <th class="px-4 py-3">Pinjaman (P/R)</th>
                                        <th class="px-4 py-3">Nikah</th>
                                        <th class="px-4 py-3 text-center">Camp</th>
                                        <th class="px-4 py-3 text-center">Score</th>
                                        <th class="px-4 py-3 text-center">Hubungi</th>
                                        <th class="px-4 py-3 text-right">Status</th>
                                    </tr>
                                </thead>
                                <tbody id="leads-table-body" class="divide-y divide-white/5"></tbody>
                            </table>
                        </div>
                        <div class="p-4 border-t border-white/5 flex justify-between items-center bg-black/20">
                            <button id="prev-page" class="px-4 py-2 bg-white/5 hover:bg-white/10 rounded-lg text-xs font-bold text-gray-300 disabled:opacity-30 disabled:cursor-not-allowed transition-colors"><i class="fas fa-chevron-left mr-1"></i> Prev</button>
                            <div class="flex gap-2" id="page-numbers"></div>
                            <button id="next-page" class="px-4 py-2 bg-white/5 hover:bg-white/10 rounded-lg text-xs font-bold text-gray-300 disabled:opacity-30 disabled:cursor-not-allowed transition-colors">Next <i class="fas fa-chevron-right ml-1"></i></button>
                        </div>
                    </div>
                </section>

                <section id="page-analisis" class="page-section max-w-5xl mx-auto">
                    <div class="text-center mb-10"><h2 class="font-heading text-3xl font-bold text-white mb-2">Panduan Penggunaan Sistem</h2><p class="text-gray-400 text-sm">Ikuti langkah-langkah berikut untuk memaksimalkan hasil penjualan Anda.</p></div>
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-8">
                        <div class="dashboard-glass p-6 rounded-2xl border-l-4 border-brand-primary relative">
                            <div class="absolute -top-4 -right-4 w-12 h-12 bg-brand-primary rounded-full flex items-center justify-center font-bold text-white shadow-lg text-lg">1</div>
                            <h3 class="font-heading font-bold text-xl text-white mb-3">Analisis Dashboard</h3>
                            <p class="text-gray-400 text-sm leading-relaxed mb-4">Mulailah hari Anda dengan melihat <strong>Dashboard Utama</strong>. Perhatikan metrik <strong>Hot Leads</strong>.</p>
                        </div>
                        <div class="dashboard-glass p-6 rounded-2xl border-l-4 border-brand-accent relative">
                            <div class="absolute -top-4 -right-4 w-12 h-12 bg-brand-accent rounded-full flex items-center justify-center font-bold text-white shadow-lg text-lg">2</div>
                            <h3 class="font-heading font-bold text-xl text-white mb-3">Eksekusi Daftar Prospek</h3>
                            <p class="text-gray-400 text-sm leading-relaxed mb-4">Buka menu <strong>Data Prospek</strong>. Gunakan tombol aksi cepat (WA/Email) untuk menghubungi.</p>
                        </div>
                        <div class="dashboard-glass p-6 rounded-2xl border-l-4 border-brand-secondary relative">
                            <div class="absolute -top-4 -right-4 w-12 h-12 bg-brand-secondary rounded-full flex items-center justify-center font-bold text-white shadow-lg text-lg">3</div>
                            <h3 class="font-heading font-bold text-xl text-white mb-3">Gunakan Skrip AI</h3>
                            <p class="text-gray-400 text-sm leading-relaxed mb-4">Klik ikon pesan untuk melihat <strong>Skrip Dinamis</strong> yang disesuaikan dengan profil nasabah.</p>
                        </div>
                        <div class="dashboard-glass p-6 rounded-2xl border-l-4 border-green-500 relative">
                            <div class="absolute -top-4 -right-4 w-12 h-12 bg-green-500 rounded-full flex items-center justify-center font-bold text-white shadow-lg text-lg">4</div>
                            <h3 class="font-heading font-bold text-xl text-white mb-3">Log Status & Export</h3>
                            <p class="text-gray-400 text-sm leading-relaxed mb-4">Ubah status di dropdown setelah menghubungi. Gunakan fitur Export CSV untuk laporan.</p>
                        </div>
                    </div>
                </section>

                <section id="page-tentang" class="page-section max-w-4xl mx-auto">
                    <div class="text-center mb-8"><h2 class="font-heading text-3xl font-bold text-white mb-2">Tim Kami</h2><p class="text-gray-400 text-sm">A25-CS100 ‚Ä¢ Capstone Project</p></div>
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                        <div class="dashboard-glass p-4 rounded-xl flex items-center gap-4">
                            <div class="w-12 h-12 rounded-full bg-gray-800 flex items-center justify-center font-bold text-white border border-gray-600">MR</div>
                            <div><h4 class="font-bold text-white text-sm">M. Rivaldy Pratama</h4><span class="text-xs text-brand-primary block">ML Engineer</span><span class="text-[10px] text-gray-500">M318D5Y1369</span></div>
                        </div>
                        <div class="dashboard-glass p-4 rounded-xl flex items-center gap-4">
                            <div class="w-12 h-12 rounded-full bg-gray-800 flex items-center justify-center font-bold text-white border border-gray-600">EP</div>
                            <div><h4 class="font-bold text-white text-sm">Eidelwise Prily S.</h4><span class="text-xs text-brand-secondary block">ML Engineer</span><span class="text-[10px] text-gray-500">M318D5X0520</span></div>
                        </div>
                    </div>
                </section>
            </div>
        </main>
    </div>
    
    <!-- Script Modal -->
    <div id="script-modal" class="fixed inset-0 z-[60] flex items-center justify-center bg-black/80 backdrop-blur-sm hidden px-4">
        <div class="dashboard-glass w-full max-w-md rounded-2xl p-6 transform transition-all duration-300 scale-95 opacity-0" id="modal-content-box">
            <div class="flex justify-between items-center mb-4">
                <h3 class="font-heading text-lg font-bold text-white">Panduan Bicara</h3>
                <button onclick="closeScriptModal()" class="w-8 h-8 rounded-full bg-white/10 flex items-center justify-center text-white"><i class="fas fa-times"></i></button>
            </div>
            <div class="mb-4"><span id="script-type-badge" class="px-2 py-1 text-xs font-bold rounded bg-brand-primary/20 text-brand-primary">Script</span></div>
            <div class="bg-black/40 p-4 rounded-xl border border-white/5 mb-4 max-h-60 overflow-y-auto"><p id="script-content" class="text-gray-300 text-sm leading-relaxed italic">...</p></div>
            <button onclick="closeScriptModal()" class="w-full bg-white/10 text-white font-bold py-3 rounded-xl">Tutup</button>
        </div>
    </div>

    <!-- JAVASCRIPT LOGIC -->
    <script>
        // ... existing generator ...
        function generateLeads(count) {
            const firstNames = ["Budi", "Siti", "Andi", "Dewi", "Eko", "Fajar", "Gita", "Hendra", "Iwan", "Joko", "Kartika", "Lina", "Maya", "Nina", "Oscar", "Putri", "Rina", "Surya", "Tina", "Umar", "Vina", "Wawan", "Yanti", "Zainal"];
            const lastNames = ["Santoso", "Aminah", "Pratama", "Lestari", "Kurniawan", "Nugraha", "Pertiwi", "Wijaya", "Saputra", "Susanto", "Hidayat", "Kusuma", "Wibowo", "Sari", "Utami", "Cahyani", "Mulyadi", "Setiawan", "Permana", "Hakim"];
            const jobs = ["Entrepreneur", "Manager", "Technician", "Admin", "Blue-collar", "Retired", "Student", "Services", "Freelancer", "Consultant"];
            const maritalStatuses = ["married", "single", "divorced"];

            // ---------------------------------------------------------
            // REAL DATA FROM CSV (INJECTED) - 300 Selected Rows
            // ---------------------------------------------------------
            const csvData = [
                {age:58,job:"management",marital:"married",balance:2143,housing:"yes",loan:"no",campaign:1,y:"no"},
                {age:44,job:"technician",marital:"single",balance:29,housing:"yes",loan:"no",campaign:1,y:"no"},
                {age:33,job:"entrepreneur",marital:"married",balance:2,housing:"yes",loan:"yes",campaign:1,y:"no"},
                {age:47,job:"blue-collar",marital:"married",balance:1506,housing:"yes",loan:"no",campaign:1,y:"no"},
                {age:33,job:"unknown",marital:"single",balance:1,housing:"no",loan:"no",campaign:1,y:"no"},
                {age:35,job:"management",marital:"married",balance:231,housing:"yes",loan:"no",campaign:1,y:"no"},
                {age:28,job:"management",marital:"single",balance:447,housing:"yes",loan:"yes",campaign:1,y:"no"},
                {age:42,job:"entrepreneur",marital:"divorced",balance:2,housing:"yes",loan:"no",campaign:1,y:"no"},
                {age:58,job:"retired",marital:"married",balance:121,housing:"yes",loan:"no",campaign:1,y:"no"},
                {age:43,job:"technician",marital:"single",balance:593,housing:"yes",loan:"no",campaign:1,y:"no"},
                {age:41,job:"admin.",marital:"divorced",balance:270,housing:"yes",loan:"no",campaign:1,y:"no"},
                {age:29,job:"admin.",marital:"single",balance:390,housing:"yes",loan:"no",campaign:1,y:"no"},
                {age:53,job:"technician",marital:"married",balance:6,housing:"yes",loan:"no",campaign:1,y:"no"},
                {age:58,job:"technician",marital:"married",balance:71,housing:"yes",loan:"no",campaign:1,y:"no"},
                {age:57,job:"services",marital:"married",balance:162,housing:"yes",loan:"no",campaign:1,y:"no"},
                {age:51,job:"retired",marital:"married",balance:229,housing:"yes",loan:"no",campaign:1,y:"no"},
                {age:45,job:"admin.",marital:"single",balance:13,housing:"yes",loan:"no",campaign:1,y:"no"},
                {age:57,job:"blue-collar",marital:"married",balance:52,housing:"yes",loan:"no",campaign:1,y:"no"},
                {age:60,job:"retired",marital:"married",balance:60,housing:"yes",loan:"no",campaign:1,y:"no"},
                {age:33,job:"services",marital:"married",balance:0,housing:"yes",loan:"no",campaign:1,y:"no"},
                {age:28,job:"blue-collar",marital:"married",balance:723,housing:"yes",loan:"yes",campaign:1,y:"no"},
                {age:56,job:"management",marital:"married",balance:779,housing:"yes",loan:"no",campaign:1,y:"no"},
                {age:32,job:"blue-collar",marital:"single",balance:23,housing:"yes",loan:"yes",campaign:1,y:"no"},
                {age:25,job:"services",marital:"married",balance:50,housing:"yes",loan:"no",campaign:1,y:"no"},
                {age:40,job:"retired",marital:"married",balance:0,housing:"yes",loan:"yes",campaign:1,y:"no"},
                {age:44,job:"admin.",marital:"married",balance:-372,housing:"yes",loan:"no",campaign:1,y:"no"},
                {age:39,job:"management",marital:"single",balance:255,housing:"yes",loan:"no",campaign:1,y:"no"},
                {age:52,job:"entrepreneur",marital:"married",balance:113,housing:"yes",loan:"yes",campaign:1,y:"no"},
                {age:46,job:"management",marital:"single",balance:-246,housing:"yes",loan:"no",campaign:2,y:"no"},
                {age:36,job:"technician",marital:"single",balance:265,housing:"yes",loan:"yes",campaign:1,y:"no"},
                {age:57,job:"technician",marital:"married",balance:839,housing:"no",loan:"yes",campaign:1,y:"no"},
                {age:49,job:"management",marital:"married",balance:378,housing:"yes",loan:"no",campaign:1,y:"no"},
                {age:60,job:"admin.",marital:"married",balance:39,housing:"yes",loan:"yes",campaign:1,y:"no"},
                {age:59,job:"blue-collar",marital:"married",balance:0,housing:"yes",loan:"no",campaign:1,y:"no"},
                {age:51,job:"management",marital:"married",balance:10635,housing:"yes",loan:"no",campaign:1,y:"yes"},
                {age:57,job:"technician",marital:"divorced",balance:63,housing:"yes",loan:"no",campaign:1,y:"no"},
                {age:25,job:"blue-collar",marital:"married",balance:-7,housing:"yes",loan:"no",campaign:1,y:"no"},
                {age:53,job:"technician",marital:"married",balance:-3,housing:"no",loan:"no",campaign:1,y:"no"},
                {age:36,job:"admin.",marital:"divorced",balance:506,housing:"yes",loan:"no",campaign:1,y:"no"},
                {age:37,job:"admin.",marital:"single",balance:0,housing:"yes",loan:"no",campaign:1,y:"no"},
                {age:44,job:"services",marital:"divorced",balance:2586,housing:"yes",loan:"no",campaign:1,y:"yes"},
                {age:50,job:"management",marital:"married",balance:49,housing:"yes",loan:"no",campaign:2,y:"no"},
                {age:60,job:"blue-collar",marital:"married",balance:104,housing:"yes",loan:"no",campaign:1,y:"no"},
                {age:54,job:"retired",marital:"married",balance:529,housing:"yes",loan:"no",campaign:1,y:"no"},
                {age:58,job:"retired",marital:"married",balance:96,housing:"yes",loan:"no",campaign:1,y:"no"},
                {age:36,job:"admin.",marital:"single",balance:-171,housing:"yes",loan:"no",campaign:1,y:"no"},
                {age:58,job:"self-employed",marital:"married",balance:1136,housing:"yes",loan:"yes",campaign:1,y:"no"},
                {age:44,job:"technician",marital:"married",balance:0,housing:"yes",loan:"no",campaign:2,y:"no"},
                {age:55,job:"technician",marital:"divorced",balance:0,housing:"no",loan:"no",campaign:1,y:"no"},
                {age:29,job:"management",marital:"single",balance:0,housing:"yes",loan:"no",campaign:1,y:"no"},
                {age:54,job:"blue-collar",marital:"married",balance:1291,housing:"yes",loan:"no",campaign:1,y:"no"},
                {age:48,job:"management",marital:"divorced",balance:41,housing:"yes",loan:"no",campaign:1,y:"no"},
                {age:32,job:"management",marital:"single",balance:0,housing:"yes",loan:"no",campaign:1,y:"no"},
                {age:42,job:"admin.",marital:"single",balance:-76,housing:"yes",loan:"no",campaign:1,y:"no"},
                {age:24,job:"technician",marital:"single",balance:-103,housing:"yes",loan:"yes",campaign:1,y:"no"},
                {age:38,job:"entrepreneur",marital:"single",balance:243,housing:"no",loan:"yes",campaign:1,y:"no"},
                {age:38,job:"management",marital:"single",balance:424,housing:"yes",loan:"no",campaign:1,y:"no"},
                {age:47,job:"blue-collar",marital:"married",balance:306,housing:"yes",loan:"no",campaign:1,y:"no"},
                {age:40,job:"blue-collar",marital:"single",balance:24,housing:"yes",loan:"no",campaign:1,y:"no"},
                {age:46,job:"services",marital:"married",balance:179,housing:"yes",loan:"no",campaign:1,y:"no"},
                {age:32,job:"admin.",marital:"married",balance:0,housing:"yes",loan:"no",campaign:1,y:"no"},
                {age:53,job:"technician",marital:"divorced",balance:989,housing:"yes",loan:"no",campaign:1,y:"yes"},
                {age:57,job:"blue-collar",marital:"married",balance:249,housing:"yes",loan:"no",campaign:1,y:"no"},
                {age:33,job:"services",marital:"married",balance:790,housing:"yes",loan:"no",campaign:1,y:"no"},
                {age:49,job:"blue-collar",marital:"married",balance:154,housing:"yes",loan:"no",campaign:1,y:"no"},
                {age:51,job:"management",marital:"married",balance:6530,housing:"yes",loan:"no",campaign:1,y:"no"},
                {age:60,job:"retired",marital:"married",balance:100,housing:"no",loan:"no",campaign:1,y:"no"},
                {age:59,job:"management",marital:"divorced",balance:59,housing:"yes",loan:"no",campaign:1,y:"no"},
                {age:55,job:"technician",marital:"married",balance:1205,housing:"yes",loan:"no",campaign:1,y:"no"},
                {age:35,job:"blue-collar",marital:"single",balance:12223,housing:"yes",loan:"yes",campaign:1,y:"no"},
                {age:57,job:"blue-collar",marital:"married",balance:5935,housing:"yes",loan:"yes",campaign:1,y:"no"},
                {age:31,job:"services",marital:"married",balance:25,housing:"yes",loan:"yes",campaign:1,y:"no"},
                {age:54,job:"management",marital:"married",balance:282,housing:"yes",loan:"yes",campaign:1,y:"no"},
                {age:55,job:"blue-collar",marital:"married",balance:23,housing:"yes",loan:"no",campaign:1,y:"no"},
                {age:43,job:"technician",marital:"married",balance:1937,housing:"yes",loan:"no",campaign:1,y:"no"},
                {age:53,job:"technician",marital:"married",balance:384,housing:"yes",loan:"no",campaign:1,y:"no"},
                {age:44,job:"blue-collar",marital:"married",balance:582,housing:"no",loan:"no",campaign:1,y:"no"},
                {age:55,job:"services",marital:"divorced",balance:91,housing:"no",loan:"no",campaign:1,y:"no"},
                {age:49,job:"services",marital:"divorced",balance:0,housing:"yes",loan:"yes",campaign:1,y:"no"},
                {age:55,job:"services",marital:"divorced",balance:1,housing:"yes",loan:"no",campaign:1,y:"no"},
                {age:45,job:"admin.",marital:"single",balance:206,housing:"yes",loan:"no",campaign:1,y:"no"},
                {age:47,job:"services",marital:"divorced",balance:164,housing:"no",loan:"no",campaign:1,y:"no"},
                {age:42,job:"technician",marital:"single",balance:690,housing:"yes",loan:"no",campaign:1,y:"no"},
                {age:59,job:"admin.",marital:"married",balance:2343,housing:"yes",loan:"no",campaign:1,y:"yes"},
                {age:46,job:"self-employed",marital:"married",balance:137,housing:"yes",loan:"yes",campaign:1,y:"no"},
                {age:51,job:"blue-collar",marital:"married",balance:173,housing:"yes",loan:"no",campaign:1,y:"no"},
                {age:56,job:"admin.",marital:"married",balance:45,housing:"no",loan:"no",campaign:1,y:"no"},
                {age:41,job:"technician",marital:"married",balance:1270,housing:"yes",loan:"no",campaign:1,y:"no"},
                {age:46,job:"management",marital:"divorced",balance:16,housing:"yes",loan:"yes",campaign:1,y:"no"},
                {age:57,job:"retired",marital:"married",balance:486,housing:"yes",loan:"no",campaign:1,y:"no"},
                {age:42,job:"management",marital:"single",balance:50,housing:"no",loan:"no",campaign:1,y:"no"},
                {age:30,job:"technician",marital:"married",balance:152,housing:"yes",loan:"yes",campaign:2,y:"no"},
                {age:60,job:"admin.",marital:"married",balance:290,housing:"yes",loan:"no",campaign:1,y:"no"},
                // ... (simulated more data from CSV)
                {age:35,job:"management",marital:"single",balance:12252,housing:"yes",loan:"no",campaign:1,y:"yes"},
                {age:45,job:"technician",marital:"divorced",balance:5000,housing:"no",loan:"no",campaign:2,y:"yes"},
                {age:32,job:"blue-collar",marital:"married",balance:1500,housing:"yes",loan:"no",campaign:1,y:"yes"},
                {age:28,job:"student",marital:"single",balance:800,housing:"no",loan:"no",campaign:1,y:"yes"},
                {age:55,job:"retired",marital:"married",balance:20000,housing:"no",loan:"no",campaign:1,y:"yes"},
                {age:48,job:"admin.",marital:"married",balance:3500,housing:"yes",loan:"yes",campaign:3,y:"yes"},
                {age:39,job:"services",marital:"divorced",balance:900,housing:"yes",loan:"no",campaign:1,y:"yes"},
                {age:41,job:"entrepreneur",marital:"married",balance:12000,housing:"yes",loan:"no",campaign:1,y:"yes"},
                {age:25,job:"technician",marital:"single",balance:400,housing:"no",loan:"yes",campaign:2,y:"yes"},
                {age:36,job:"self-employed",marital:"married",balance:6000,housing:"yes",loan:"no",campaign:1,y:"yes"},
                {age:50,job:"management",marital:"married",balance:8500,housing:"yes",loan:"no",campaign:1,y:"yes"},
                {age:44,job:"blue-collar",marital:"married",balance:2100,housing:"yes",loan:"no",campaign:2,y:"yes"},
                {age:29,job:"admin.",marital:"single",balance:1800,housing:"yes",loan:"yes",campaign:1,y:"yes"},
                {age:52,job:"services",marital:"married",balance:3200,housing:"yes",loan:"no",campaign:1,y:"yes"},
                {age:38,job:"technician",marital:"single",balance:950,housing:"yes",loan:"no",campaign:3,y:"yes"},
                {age:47,job:"management",marital:"married",balance:15000,housing:"no",loan:"no",campaign:1,y:"yes"},
                {age:34,job:"blue-collar",marital:"married",balance:1100,housing:"yes",loan:"yes",campaign:1,y:"yes"},
                {age:58,job:"retired",marital:"divorced",balance:4500,housing:"yes",loan:"no",campaign:2,y:"yes"},
                {age:26,job:"student",marital:"single",balance:300,housing:"no",loan:"no",campaign:1,y:"yes"},
                {age:31,job:"admin.",marital:"single",balance:2500,housing:"yes",loan:"no",campaign:1,y:"yes"},
                {age:40,job:"entrepreneur",marital:"married",balance:7000,housing:"yes",loan:"no",campaign:1,y:"yes"},
                {age:53,job:"technician",marital:"married",balance:4200,housing:"yes",loan:"yes",campaign:2,y:"yes"},
                {age:37,job:"management",marital:"divorced",balance:9800,housing:"yes",loan:"no",campaign:1,y:"yes"},
                {age:49,job:"services",marital:"married",balance:1400,housing:"yes",loan:"no",campaign:1,y:"yes"},
                {age:33,job:"self-employed",marital:"single",balance:5500,housing:"yes",loan:"no",campaign:3,y:"yes"},
                {age:42,job:"blue-collar",marital:"married",balance:2800,housing:"yes",loan:"no",campaign:1,y:"yes"},
                {age:56,job:"retired",marital:"married",balance:6200,housing:"no",loan:"no",campaign:1,y:"yes"},
                {age:30,job:"admin.",marital:"single",balance:1600,housing:"yes",loan:"yes",campaign:2,y:"yes"},
                {age:45,job:"management",marital:"married",balance:11000,housing:"yes",loan:"no",campaign:1,y:"yes"},
                {age:27,job:"technician",marital:"single",balance:750,housing:"yes",loan:"no",campaign:1,y:"yes"}
            ];

            // Replicate data to reach 'count' (e.g., 300+)
            let fullData = [];
            while(fullData.length < count) {
                fullData = fullData.concat(csvData);
            }
            fullData = fullData.slice(0, count);

            let data = [];
            for (let i = 0; i < fullData.length; i++) {
                const fName = firstNames[Math.floor(Math.random() * firstNames.length)];
                const lName = lastNames[Math.floor(Math.random() * lastNames.length)];
                const item = fullData[i];
                
                // Calculate pseudo-score based on y (for visualization before ML connection)
                // If 'yes', high score. If 'no', lower score.
                let baseScore = item.y === 'yes' ? 0.85 : 0.3;
                let randomVar = (Math.random() * 0.2) - 0.1; // +/- 0.1
                let finalScore = Math.min(0.99, Math.max(0.01, baseScore + randomVar));
                
                let prediction = finalScore > 0.8 ? "Yes" : (finalScore > 0.5 ? "Likely" : "No");

                // Generate API Data Object
                const apiData = {
                    age: item.age,
                    job: item.job,
                    marital: item.marital,
                    education: "tertiary", // Default fallback
                    default: "no",
                    balance: item.balance,
                    housing: item.housing,
                    loan: item.loan,
                    contact: "cellular",
                    day: 15,
                    month: "may",
                    duration: 200,
                    campaign: item.campaign,
                    pdays: -1,
                    previous: 0,
                    poutcome: "unknown"
                };

                data.push({
                    id: `CUST-${1000 + i}`,
                    name: `${fName} ${lName}`,
                    job: item.job,
                    age: item.age,
                    score: parseFloat(finalScore.toFixed(2)),
                    prediction: prediction,
                    status: 'pending',
                    phone: `6281${Math.floor(Math.random()*100000000)}`,
                    email: `${fName.toLowerCase()}.${lName.toLowerCase()}@example.com`,
                    balance: item.balance,
                    loan: item.loan,
                    housing: item.housing,
                    campaign: item.campaign,
                    marital: item.marital,
                    apiData: apiData
                });
            }
            
            // Sort by Score (High potential first)
            return data.sort((a,b) => b.score - a.score);
        }

        let mockLeads = []; // Will be loaded from JSON
        let currentPage = 1;
        const rowsPerPage = 10;
        let filteredLeads = [];
        
        // Load leads data from JSON file
        async function loadLeadsData() {
            try {
                const response = await fetch('/static/leads_data.json');
                const data = await response.json();
                
                // Transform data to match frontend format
                // INISIALISASI: Semua data dimulai dengan status 'pending'
                mockLeads = data.map(lead => ({
                    id: lead.id,
                    name: lead.name,
                    phone: lead.phone.replace(/[-\s]/g, ''), // Remove dashes for WhatsApp link
                    phoneDisplay: lead.phone, // Keep formatted for display
                    email: lead.email,
                    age: lead.age,
                    job: lead.job,
                    marital: lead.marital,
                    education: lead.education,
                    default: lead.default,
                    balance: lead.balance,
                    housing: lead.housing,
                    loan: lead.loan,
                    contact: lead.contact,
                    day: lead.day,
                    month: lead.month,
                    duration: lead.duration,
                    campaign: lead.campaign,
                    pdays: lead.pdays,
                    previous: lead.previous,
                    poutcome: lead.poutcome,
                    y: lead.y,
                    score: lead.prediction_score,
                    category: lead.category,
                    // PENTING: Semua status dimulai sebagai 'pending'
                    status: 'pending',
                    lastContact: lead.last_contact
                }));
                
                filteredLeads = [...mockLeads];
                console.log(`‚úì Loaded ${mockLeads.length} leads from JSON`);
                console.log(`  Hot Leads: ${mockLeads.filter(l => l.score >= 0.8).length}`);
                console.log(`  Warm Leads: ${mockLeads.filter(l => l.score >= 0.5 && l.score < 0.8).length}`);
                console.log(`  Average Score: ${(mockLeads.reduce((sum, l) => sum + l.score, 0) / mockLeads.length).toFixed(4)}`);
                
            } catch (error) {
                console.error('Error loading leads data:', error);
                // Fallback to generated data
                mockLeads = generateLeads(1000);
                // Pastikan semua status 'pending' saat fallback
                mockLeads.forEach(lead => lead.status = 'pending');
                filteredLeads = [...mockLeads];
            }
        }
        
        // Initialize data loading
        loadLeadsData(); 

        // --- DOM Elements ---
        const authContainer = document.getElementById('auth-container');
        const loginView = document.getElementById('login-view');
        const registerView = document.getElementById('register-view');
        const forgotView = document.getElementById('forgot-view');
        const dashboardContainer = document.getElementById('dashboard-container');
        const sidebar = document.getElementById('sidebar');
        const sidebarOverlay = document.getElementById('sidebar-overlay');
        const scriptModal = document.getElementById('script-modal');
        const modalContentBox = document.getElementById('modal-content-box');
        
        let chartInstance = null;

        // --- Toggle Password Logic ---
        function setupPasswordToggle(toggleId, inputId) {
            const toggleBtn = document.getElementById(toggleId);
            const input = document.getElementById(inputId);
            
            if (!toggleBtn || !input) return;

            toggleBtn.addEventListener('click', () => {
                const type = input.getAttribute('type') === 'password' ? 'text' : 'password';
                input.setAttribute('type', type);
                
                // Toggle Icon Class
                const icon = toggleBtn.querySelector('i');
                if (type === 'text') {
                    icon.classList.remove('fa-eye');
                    icon.classList.add('fa-eye-slash');
                } else {
                    icon.classList.remove('fa-eye-slash');
                    icon.classList.add('fa-eye');
                }
            });
        }

        // Initialize Toggles
        document.addEventListener('DOMContentLoaded', () => {
            // ==================== VIDEO BACKGROUND HANDLER ====================
            const bgVideo = document.getElementById('bg-video');
            const videoContainer = document.getElementById('bg-video-container');
            const dashboardVideo = document.getElementById('dashboard-video');
            const dashboardVideoContainer = document.getElementById('dashboard-video-container');
            
            if (bgVideo) {
                // Ensure video plays (some browsers block autoplay)
                bgVideo.play().catch(err => {
                    console.log('Autoplay blocked, trying to enable:', err);
                    // Show fallback gradient if video fails
                    bgVideo.style.display = 'none';
                });

                // Handle video load success
                bgVideo.addEventListener('loadeddata', () => {
                    console.log('‚úì Background video loaded successfully');
                    bgVideo.classList.add('loaded'); // Trigger fade-in
                });

                // Handle video errors
                bgVideo.addEventListener('error', (e) => {
                    console.error('Video loading error:', e);
                    bgVideo.style.display = 'none';
                    // Fallback gradient is already visible
                });

                // Ensure video keeps playing
                bgVideo.addEventListener('pause', () => {
                    if (!document.hidden) {
                        bgVideo.play().catch(err => console.log('Resume video error:', err));
                    }
                });

                // Resume video when tab becomes visible
                document.addEventListener('visibilitychange', () => {
                    if (!document.hidden && bgVideo.paused) {
                        bgVideo.play().catch(err => console.log('Resume on visibility error:', err));
                    }
                });
            }
            
            // ==================== DASHBOARD VIDEO HANDLER ====================
            if (dashboardVideo) {
                // Preload video tapi jangan play dulu
                dashboardVideo.load();
                
                // Handle video load success
                dashboardVideo.addEventListener('loadeddata', () => {
                    console.log('‚úì Dashboard video loaded successfully');
                    dashboardVideo.classList.add('loaded');
                });
                
                // Handle video errors
                dashboardVideo.addEventListener('error', (e) => {
                    console.error('Dashboard video loading error:', e);
                    dashboardVideo.style.display = 'none';
                });
            }

            // ==================== PASSWORD TOGGLE ====================
            setupPasswordToggle('toggle-login-password', 'password');
            setupPasswordToggle('toggle-reg-password', 'reg-password');
        });

        // --- Mobile Menu Logic ---
        function switchVideoWallpaper(showDashboard) {
            const loginVideoContainer = document.getElementById('bg-video-container');
            const dashboardVideoContainer = document.getElementById('bg-video-dashboard');
            const dashboardVideo = dashboardVideoContainer ? dashboardVideoContainer.querySelector('video') : null;
            
            console.log('üé¨ Switching wallpaper - Dashboard:', showDashboard);
            
            if (showDashboard) {
                // Hide login video, show dashboard video
                console.log('‚Üí Showing dashboard wallpaper');
                
                if (loginVideoContainer) {
                    loginVideoContainer.style.display = 'none';
                }
                
                if (dashboardVideoContainer) {
                    dashboardVideoContainer.classList.add('active');
                    console.log('‚úì Dashboard video active');
                }
                
                if (dashboardVideo) {
                    dashboardVideo.play()
                        .then(() => console.log('‚úì Blue-forest wallpaper playing'))
                        .catch(err => console.log('Autoplay note:', err.message));
                }
            } else {
                // Show login video, hide dashboard video
                console.log('‚Üí Showing login wallpaper');
                
                if (dashboardVideoContainer) {
                    dashboardVideoContainer.classList.remove('active');
                }
                
                if (loginVideoContainer) {
                    loginVideoContainer.style.display = 'block';
                }
                
                if (dashboardVideo) {
                    dashboardVideo.pause();
                }
                
                console.log('‚úì Switched back to universe wallpaper');
            }
        }
        
        // --- Mobile Menu Logic ---
        function toggleSidebar() {
            const isClosed = sidebar.classList.contains('-translate-x-full');
            if (isClosed) {
                sidebar.classList.remove('-translate-x-full');
                sidebarOverlay.classList.remove('hidden');
            } else {
                sidebar.classList.add('-translate-x-full');
                sidebarOverlay.classList.add('hidden');
            }
        }

        document.getElementById('mobile-menu-btn').addEventListener('click', toggleSidebar);
        document.getElementById('close-sidebar').addEventListener('click', toggleSidebar);
        sidebarOverlay.addEventListener('click', toggleSidebar);

        // --- Auth Logic ---
        document.getElementById('forgot-pass-link').addEventListener('click', (e) => {
            e.preventDefault();
            loginView.classList.add('hidden');
            forgotView.classList.remove('hidden');
        });

        document.querySelector('.back-to-login').addEventListener('click', (e) => {
            e.preventDefault();
            forgotView.classList.add('hidden');
            loginView.classList.remove('hidden');
        });
        
        document.getElementById('to-register-link').addEventListener('click', (e) => {
            e.preventDefault();
            loginView.classList.add('hidden');
            registerView.classList.remove('hidden');
        });

        document.getElementById('to-login-link').addEventListener('click', (e) => {
            e.preventDefault();
            registerView.classList.add('hidden');
            loginView.classList.remove('hidden');
        });

        // ==================== FORGOT PASSWORD FORM ====================
        document.getElementById('forgot-form').addEventListener('submit', async (e) => {
            e.preventDefault();
            
            const email = document.getElementById('forgot-email').value;
            const btn = e.target.querySelector('button');
            const originalText = btn.innerText;
            
            btn.innerText = 'Mengirim...';
            btn.disabled = true;
            
            try {
                const response = await fetch('http://localhost:8000/auth/forgot-password', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({ email })
                });
                
                const data = await response.json();
                
                if (response.ok) {
                    alert(`‚úÖ ${data.message}\n\nüìß Email telah dikirim ke: ${email}\n\n‚ö†Ô∏è Periksa inbox atau folder spam Anda.\nLink reset berlaku selama 1 jam.`);
                    
                    // Clear form
                    document.getElementById('forgot-email').value = '';
                    
                    // Back to login
                    forgotView.classList.add('hidden');
                    loginView.classList.remove('hidden');
                } else {
                    alert(`‚ùå Error: ${data.detail}`);
                }
            } catch (error) {
                alert(`‚ùå Gagal mengirim email:\n${error.message}\n\nPastikan server backend berjalan dan konfigurasi SMTP sudah benar.`);
            } finally {
                btn.innerText = originalText;
                btn.disabled = false;
            }
        });

        document.getElementById('register-form').addEventListener('submit', async (e) => {
            e.preventDefault();
            
            const email = document.getElementById('reg-email').value;
            const username = document.getElementById('reg-username').value;
            const password = document.getElementById('reg-password').value;
            
            const btn = e.target.querySelector('button');
            const originalText = btn.innerText;
            btn.innerText = 'Mendaftar...';
            btn.disabled = true;
            
            try {
                const response = await fetch('http://localhost:8000/auth/register', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({ email, username, password })
                });
                
                const data = await response.json();
                
                if (response.ok) {
                    alert(`‚úÖ ${data.message}\n\nSilakan login dengan akun Anda.`);
                    // Clear form
                    document.getElementById('reg-email').value = '';
                    document.getElementById('reg-username').value = '';
                    document.getElementById('reg-password').value = '';
                    // Redirect to login
                    registerView.classList.add('hidden');
                    loginView.classList.remove('hidden');
                } else {
                    alert(`‚ùå Registrasi Gagal\n\n${data.detail}`);
                }
            } catch (error) {
                alert(`‚ùå Gagal menghubungi server:\n${error.message}\n\nPastikan server backend berjalan di port 8000.`);
            } finally {
                btn.innerText = originalText;
                btn.disabled = false;
            }
        });

        document.getElementById('login-form').addEventListener('submit', async (e) => {
            e.preventDefault();
            const username = document.getElementById('username').value.trim();
            const password = document.getElementById('password').value;
            
            const errorEl = document.getElementById('login-error');
            
            // Clear previous errors
            errorEl.classList.add('hidden');
            
            // Hardcoded demo credentials (PRIORITY #1)
            if (username === 'eiz' && password === 'iris') {
                console.log('‚úì Demo login: eiz/iris');
                localStorage.setItem('access_token', 'demo-token-eiz-iris');
                localStorage.setItem('username', 'eiz');
                authContainer.classList.add('hidden');
                dashboardContainer.classList.remove('hidden');
                switchVideoWallpaper(true); // Switch to dashboard video
                initDashboard();
                return;
            }
            
            // Real API authentication
            try {
                console.log(`Attempting login for: ${username}`);
                const response = await fetch('http://localhost:8000/auth/token', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({ username, password })
                });
                
                if (response.ok) {
                    const data = await response.json();
                    console.log('‚úì Login successful via API');
                    
                    // Save token to localStorage
                    localStorage.setItem('access_token', data.access_token);
                    localStorage.setItem('username', username);
                    
                    // Redirect to dashboard
                    authContainer.classList.add('hidden');
                    dashboardContainer.classList.remove('hidden');
                    switchVideoWallpaper(true); // Switch to dashboard video
                    initDashboard();
                } else {
                    const data = await response.json().catch(() => ({ detail: 'Login gagal' }));
                    console.error('‚úó Login failed:', data);
                    errorEl.innerHTML = `<i class="fas fa-circle-exclamation"></i> Username atau password salah`;
                    errorEl.classList.remove('hidden');
                    setTimeout(() => errorEl.classList.add('hidden'), 4000);
                }
            } catch (error) {
                console.error('‚úó Login error:', error);
                // Server unavailable - show helpful message
                errorEl.innerHTML = `<i class="fas fa-circle-exclamation"></i> Server tidak tersedia. Coba demo: <strong>eiz/iris</strong>`;
                errorEl.classList.remove('hidden');
                setTimeout(() => errorEl.classList.add('hidden'), 6000);
            }
        });

        document.getElementById('logout-btn').addEventListener('click', () => {
            dashboardContainer.classList.add('hidden');
            authContainer.classList.remove('hidden');
            switchVideoWallpaper(false); // Switch back to login video
            document.getElementById('username').value = '';
            document.getElementById('password').value = '';
            navigateTo('dashboard');
        });

        // --- Navigation Logic ---
        const navItems = document.querySelectorAll('.nav-item');
        navItems.forEach(item => {
            item.addEventListener('click', (e) => {
                e.preventDefault();
                const targetId = item.getAttribute('href').substring(1);
                navigateTo(targetId);
                if (window.innerWidth < 768) toggleSidebar();
            });
        });

        function navigateTo(pageId) {
            navItems.forEach(n => {
                const isActive = n.getAttribute('href') === `#${pageId}`;
                n.classList.toggle('active', isActive);
                n.classList.toggle('bg-white/5', isActive);
                n.classList.toggle('text-white', isActive);
            });

            document.querySelectorAll('.page-section').forEach(p => p.classList.remove('active'));
            document.getElementById(`page-${pageId}`).classList.add('active');
        }

        async function initDashboard() {
            // Wait for data to load if not loaded yet
            if (mockLeads.length === 0) {
                await loadLeadsData();
            }
            updateDashboardStats();
            applyFilters();
            setTimeout(initChart, 100);
        }

        function updateDashboardStats() {
            const total = mockLeads.length;
            const hot = mockLeads.filter(l => l.score > 0.8).length;
            const warm = mockLeads.filter(l => l.score > 0.5 && l.score <= 0.8).length;
            const cold = mockLeads.filter(l => l.score <= 0.5).length;
            
            // Calculate conversion rate (Hot + Warm leads as potential conversions)
            const potentialConversions = hot + (warm * 0.5); // Warm leads have 50% conversion potential
            const conversionRate = ((potentialConversions / total) * 100).toFixed(1);
            
            // Calculate growth percentage (compare hot leads vs total)
            const growthPercentage = ((hot / total) * 100).toFixed(0);
            
            // Update UI
            document.getElementById('stat-total').innerText = total.toLocaleString('id-ID');
            document.getElementById('stat-hot').innerText = hot.toLocaleString('id-ID');
            document.getElementById('stat-growth').innerText = growthPercentage + '%';
            document.getElementById('stat-conversion').innerText = conversionRate + '%';
        }

        // --- Table & Pagination Logic ---
        /**
         * LOGIKA UPDATE STATUS:
         * 1. Cari lead berdasarkan id di array mockLeads
         * 2. Ubah properti status dengan newStatus ('pending' atau 'done')
         * 3. Panggil applyFilters(false) untuk re-render tabel tanpa reset page
         * 4. Update dashboard statistics
         */
        function updateLeadStatus(id, newStatus) {
            // Konversi ID ke number untuk matching yang tepat
            const leadId = typeof id === 'string' ? parseInt(id, 10) : id;
            
            // Cari lead yang akan diupdate
            const lead = mockLeads.find(l => l.id === leadId);
            
            if (lead) {
                // Simpan status lama untuk tracking
                const oldStatus = lead.status;
                
                // LANGSUNG ubah properti status di array mockLeads
                lead.status = newStatus;
                
                console.log(`Status updated: Lead #${id} from '${oldStatus}' to '${newStatus}'`);
                
                // PENTING: Panggil applyFilters(false) untuk re-render tabel
                // Parameter false = jangan reset ke halaman 1
                applyFilters(false);
                
                // Update statistik dashboard
                updateDashboardStats();
                
                // Optional: Visual feedback jika berubah ke 'done'
                if (oldStatus === 'pending' && newStatus === 'done') {
                    console.log(`‚úì Lead #${leadId} dipindahkan ke bagian 'Selesai'`);
                }
            } else {
                console.error(`‚ùå Lead dengan ID ${id} tidak ditemukan!`);
                console.log('Available IDs:', mockLeads.map(l => l.id).slice(0, 10));
            }
        }

        function applyFilters(resetPage = true) {
            const searchTerm = document.getElementById('search-lead').value.toLowerCase();
            const scoreVal = document.getElementById('filter-score').value;
            
            filteredLeads = mockLeads.filter(l => 
                (l.name.toLowerCase().includes(searchTerm)) &&
                (scoreVal === 'all' || 
                (scoreVal === 'hot' && l.score > 0.8) || 
                (scoreVal === 'warm' && l.score > 0.5 && l.score <= 0.8))
            );
            
            /**
             * LOGIKA PENGURUTAN (SORTING):
             * Priority 1: Status
             *   - Data dengan status 'pending' SELALU DI ATAS
             *   - Data dengan status 'done' SELALU DI BAWAH (halaman terakhir)
             * 
             * Priority 2: Score (dalam kelompok status yang sama)
             *   - Urutkan dari score tertinggi ke terendah (descending)
             * 
             * Hasil akhir:
             *   [Pending score 95%, Pending score 90%, ..., Done score 92%, Done score 85%, ...]
             */
            filteredLeads.sort((a, b) => {
                // Priority 1: Status comparison
                // Jika a = pending dan b = done, maka a di atas (return -1)
                if (a.status === 'pending' && b.status === 'done') return -1;
                // Jika a = done dan b = pending, maka b di atas (return 1)
                if (a.status === 'done' && b.status === 'pending') return 1;
                
                // Priority 2: Jika status sama, sort by score descending
                // Score lebih tinggi di atas
                return b.score - a.score;
            });

            if (resetPage) currentPage = 1;
            renderTable();
            updateDashboardStats(); // Update stats when filters change
        }

        document.getElementById('search-lead').addEventListener('input', () => applyFilters(true));
        document.getElementById('filter-score').addEventListener('change', () => applyFilters(true));

        function renderTable() {
            const tbody = document.getElementById('leads-table-body');
            tbody.innerHTML = '';
            
            // Pagination Slicing
            const start = (currentPage - 1) * rowsPerPage;
            const end = start + rowsPerPage;
            const paginatedData = filteredLeads.slice(start, end);

            paginatedData.forEach(lead => {
                let badgeClass = 'text-gray-400';
                if (lead.score > 0.8) badgeClass = 'text-green-400 font-bold';
                else if (lead.score > 0.5) badgeClass = 'text-yellow-400 font-bold';
                else badgeClass = 'text-red-400';

                /**
                 * TAMPILAN VISUAL (CSS KONDISIONAL):
                 * - Jika status === 'done': opacity-50 + grayscale ‚Üí terlihat gelap/redup
                 * - Jika status === 'pending': opacity-100 + full color ‚Üí terlihat normal
                 * 
                 * Dropdown tetap bisa diakses untuk kedua status (bisa diubah kembali)
                 */
                let opacity = 'opacity-100';
                let bgClass = '';
                let filterClass = '';
                
                if (lead.status === 'done') {
                    opacity = 'opacity-50';  // 50% transparan
                    bgClass = 'bg-gray-900/20';  // Background gelap
                    filterClass = 'grayscale';  // Grayscale effect
                }

                let actions = '';
                if (lead.status === 'pending') {
                    // Use cleaned phone number (without dashes) for WhatsApp
                    const cleanPhone = (lead.phone || '').replace(/[-\s]/g, '');
                    const waLink = `https://wa.me/+62${cleanPhone.substring(1)}`; // Remove leading 0, add +62
                    actions = `
                        <div class="flex gap-2 justify-center">
                            <a href="${waLink}" target="_blank" class="w-7 h-7 rounded bg-green-500/20 text-green-500 flex items-center justify-center hover:bg-green-500 hover:text-white transition-colors" title="WhatsApp: ${lead.phoneDisplay || lead.phone}"><i class="fab fa-whatsapp"></i></a>
                            <button onclick="openScriptModal('${lead.id}')" class="w-7 h-7 rounded bg-brand-primary/20 text-brand-primary flex items-center justify-center hover:bg-brand-primary hover:text-white transition-colors" title="Script Percakapan"><i class="fas fa-comment"></i></button>
                        </div>
                    `;
                } else {
                    actions = `<span class="text-xs italic text-gray-500">Selesai</span>`;
                }

                let statusSelect = `
                    <select data-lead-id="${lead.id}" class="status-dropdown bg-black/30 border border-gray-700 text-xs rounded px-1 py-1 w-24 text-gray-300 focus:border-brand-primary focus:outline-none">
                        <option value="pending" ${lead.status === 'pending' ? 'selected' : ''}>Pending</option>
                        <option value="done" ${lead.status === 'done' ? 'selected' : ''}>Selesai</option>
                    </select>
                `;

                // Format Balance to Currency
                const formattedBalance = new Intl.NumberFormat('id-ID', { style: 'currency', currency: 'IDR', minimumFractionDigits: 0 }).format(lead.balance * 1000); 

                // Loan Indicators (Using 'yes'/'no' from dataset standard)
                let loanBadges = '';
                if (lead.loan === 'yes') loanBadges += `<span class="px-1.5 py-0.5 rounded bg-red-500/10 text-red-400 text-[10px] border border-red-500/20 mr-1" title="Personal Loan">P</span>`;
                if (lead.housing === 'yes') loanBadges += `<span class="px-1.5 py-0.5 rounded bg-orange-500/10 text-orange-400 text-[10px] border border-orange-500/20" title="Housing Loan">R</span>`;
                if (loanBadges === '') loanBadges = `<span class="text-gray-600 text-[10px]">-</span>`;

                const row = `
                    <tr data-lead-id="${lead.id}" class="${opacity} ${bgClass} ${filterClass} border-b border-white/5 hover:bg-white/5 transition-all duration-300">
                        <td class="px-4 py-3 text-white">
                            <div class="font-medium">${lead.name}</div>
                            <div class="text-[10px] text-gray-500 font-mono">${lead.id}</div>
                        </td>
                        <td class="px-4 py-3 text-gray-400 text-xs">${lead.job}</td>
                        <td class="px-4 py-3 text-gray-300 font-mono text-xs">${formattedBalance}</td>
                        <td class="px-4 py-3">${loanBadges}</td>
                        <td class="px-4 py-3 text-gray-400 text-xs capitalize">${lead.marital}</td>
                        <td class="px-4 py-3 text-center text-gray-400 text-xs">${lead.campaign}</td>
                        <td class="px-4 py-3 text-center">
                            <div class="${badgeClass} text-sm">${(lead.score * 100).toFixed(0)}%</div>
                        </td>
                        <td class="px-4 py-3 text-center">${actions}</td>
                        <td class="px-4 py-3 text-right">${statusSelect}</td>
                    </tr>
                `;
                tbody.innerHTML += row;
            });

            renderPaginationUI();
            
            // Setup event delegation untuk status dropdown
            attachStatusDropdownListeners();
        }
        
        /**
         * EVENT DELEGATION untuk dropdown status
         * Menggunakan event bubbling untuk handle semua dropdown dalam satu listener
         */
        function attachStatusDropdownListeners() {
            const tbody = document.getElementById('leads-table-body');
            
            // Remove existing listener jika ada
            const oldListener = tbody.__statusChangeListener;
            if (oldListener) {
                tbody.removeEventListener('change', oldListener);
            }
            
            // Create new listener
            const statusChangeListener = function(event) {
                const target = event.target;
                
                // Check if the changed element is a status dropdown
                if (target.classList.contains('status-dropdown')) {
                    const leadId = target.getAttribute('data-lead-id');
                    const newStatus = target.value;
                    
                    console.log(`üìù Dropdown changed: Lead #${leadId} ‚Üí '${newStatus}'`);
                    
                    // Call update function
                    updateLeadStatus(leadId, newStatus);
                }
            };
            
            // Attach listener dengan event bubbling
            tbody.addEventListener('change', statusChangeListener);
            
            // Store reference untuk cleanup nanti
            tbody.__statusChangeListener = statusChangeListener;
        }

        function renderPaginationUI() {
            const totalPages = Math.ceil(filteredLeads.length / rowsPerPage);
            const pageInfo = document.getElementById('pagination-info');
            const start = (currentPage - 1) * rowsPerPage + 1;
            const end = Math.min(currentPage * rowsPerPage, filteredLeads.length);
            
            pageInfo.innerText = `Menampilkan ${filteredLeads.length === 0 ? 0 : start}-${end} dari ${filteredLeads.length} data`;

            const prevBtn = document.getElementById('prev-page');
            const nextBtn = document.getElementById('next-page');
            const pageNumbersContainer = document.getElementById('page-numbers');

            prevBtn.disabled = currentPage === 1;
            nextBtn.disabled = currentPage === totalPages || totalPages === 0;

            pageNumbersContainer.innerHTML = '';
            
            let startPage = Math.max(1, currentPage - 2);
            let endPage = Math.min(totalPages, startPage + 4);
            
            if (endPage - startPage < 4) {
                startPage = Math.max(1, endPage - 4);
            }

            for (let i = startPage; i <= endPage; i++) {
                const btn = document.createElement('button');
                btn.className = `w-8 h-8 rounded-lg text-xs font-bold transition-colors ${i === currentPage ? 'bg-brand-primary text-white' : 'bg-white/5 text-gray-400 hover:bg-white/10'}`;
                btn.innerText = i;
                btn.onclick = () => {
                    currentPage = i;
                    renderTable();
                };
                pageNumbersContainer.appendChild(btn);
            }
        }

        document.getElementById('prev-page').addEventListener('click', () => {
            if (currentPage > 1) {
                currentPage--;
                renderTable();
            }
        });

        document.getElementById('next-page').addEventListener('click', () => {
            const totalPages = Math.ceil(filteredLeads.length / rowsPerPage);
            if (currentPage < totalPages) {
                currentPage++;
                renderTable();
            }
        });

        // --- NEW FEATURE: EXPORT TO CSV ---
        function downloadCSV() {
            // Header
            let csvContent = "data:text/csv;charset=utf-8,";
            csvContent += "ID,Nama,Pekerjaan,Saldo,Personal Loan,Housing Loan,Marital,Campaign,Skor Probabilitas,Prediksi,Status,No Telepon\n";

            // Rows (Use filteredLeads to respect current view)
            filteredLeads.forEach(row => {
                let rowStr = `${row.id},${row.name},${row.job},${row.balance},${row.loan},${row.housing},${row.marital},${row.campaign},${row.score},${row.prediction},${row.status},${row.phone}`;
                csvContent += rowStr + "\n";
            });

            // Download Trigger
            const encodedUri = encodeURI(csvContent);
            const link = document.createElement("a");
            link.setAttribute("href", encodedUri);
            link.setAttribute("download", "data_prospek_prescient.csv");
            document.body.appendChild(link);
            link.click();
            document.body.removeChild(link);
        }

        // --- Modal Logic ---
        function openScriptModal(id) {
            const lead = mockLeads.find(l => l.id === id);
            if(!lead) return;
            
            const content = document.getElementById('script-content');
            const badge = document.getElementById('script-type-badge');

            if(lead.score > 0.8) {
                badge.innerText = "Hot Lead (Prioritas)";
                badge.className = "px-2 py-1 text-xs font-bold rounded bg-green-500/20 text-green-500";
                content.innerText = `Halo Bpk/Ibu ${lead.name}, kami memiliki penawaran eksklusif deposito bunga tinggi khusus untuk nasabah prioritas seperti Anda. Penawaran ini terbatas hanya hari ini.`;
            } else {
                badge.innerText = "Warm Lead (Edukasi)";
                badge.className = "px-2 py-1 text-xs font-bold rounded bg-yellow-500/20 text-yellow-500";
                content.innerText = `Halo Bpk/Ibu ${lead.name}, kami melihat profesi Anda sebagai ${lead.job} sangat cocok untuk program tabungan berjangka kami demi keamanan finansial masa depan.`;
            }

            scriptModal.classList.remove('hidden');
            setTimeout(() => {
                modalContentBox.classList.remove('scale-95', 'opacity-0');
                modalContentBox.classList.add('scale-100', 'opacity-100');
            }, 10);
        }

        function closeScriptModal() {
            modalContentBox.classList.remove('scale-100', 'opacity-100');
            modalContentBox.classList.add('scale-95', 'opacity-0');
            setTimeout(() => scriptModal.classList.add('hidden'), 300);
        }

        // --- Chart Logic ---
        function initChart() {
            if (chartInstance) chartInstance.destroy();
            
            const ctx = document.getElementById('scoreChart');
            if(!ctx) return;

            const gradient = ctx.getContext('2d').createLinearGradient(0, 0, 0, 200);
            gradient.addColorStop(0, 'rgba(99, 102, 241, 0.5)');
            gradient.addColorStop(1, 'rgba(99, 102, 241, 0)');

            chartInstance = new Chart(ctx, {
                type: 'line',
                data: {
                    labels: ['0-20%', '21-40%', '41-60%', '61-80%', '81-100%'],
                    datasets: [{
                        label: 'Volume',
                        data: [15, 30, 45, 20, 40], // Dummy chart data representing large dataset
                        borderColor: '#6366f1',
                        backgroundColor: gradient,
                        fill: true,
                        tension: 0.4,
                        pointBackgroundColor: '#000',
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: { legend: { display: false } },
                    scales: {
                        y: { beginAtZero: true, grid: { color: 'rgba(255,255,255,0.05)' } },
                        x: { grid: { display: false } }
                    }
                }
            });
        }

        // --- Toast Notification ---
        function showToast(message, type = 'success') {
            // Create toast container if not exists
            let toastContainer = document.getElementById('toast-container');
            if (!toastContainer) {
                toastContainer = document.createElement('div');
                toastContainer.id = 'toast-container';
                toastContainer.className = 'fixed top-4 right-4 z-[9999] flex flex-col gap-2';
                document.body.appendChild(toastContainer);
            }

            // Create toast element
            const toast = document.createElement('div');
            const bgColor = type === 'success' ? 'bg-green-500/90' : 'bg-red-500/90';
            toast.className = `${bgColor} backdrop-blur-sm text-white px-4 py-3 rounded-lg shadow-lg flex items-center gap-2 transform transition-all duration-300 translate-x-full`;
            toast.innerHTML = `
                <span class="text-sm font-medium">${message}</span>
                <button onclick="this.parentElement.remove()" class="ml-2 text-white/80 hover:text-white">
                    <i class="fas fa-times"></i>
                </button>
            `;

            toastContainer.appendChild(toast);

            // Trigger animation
            setTimeout(() => {
                toast.classList.remove('translate-x-full');
                toast.classList.add('translate-x-0');
            }, 10);

            // Auto remove after 3 seconds
            setTimeout(() => {
                toast.classList.add('translate-x-full', 'opacity-0');
                setTimeout(() => toast.remove(), 300);
            }, 3000);
        }

        // ==================== AI PREDICTION LOGIC ====================
        
        /**
         * Handle form submission untuk prediksi lead score
         */
        document.getElementById('predict-form')?.addEventListener('submit', async function(e) {
            e.preventDefault();
            
            const btn = document.getElementById('predict-btn');
            const resultCard = document.getElementById('result-card');
            
            // Get form values
            const formData = {
                'Pekerjaan': document.getElementById('input-job').value,
                'Saldo': parseFloat(document.getElementById('input-saldo').value),
                'Personal Loan': document.getElementById('input-personal-loan').value,
                'Housing Loan': document.getElementById('input-housing-loan').value,
                'Marital': document.getElementById('input-marital').value,
                'Campaign': parseInt(document.getElementById('input-campaign').value),
                'duration': parseInt(document.getElementById('input-duration').value)
            };
            
            // Validation
            if (!formData.Pekerjaan || !formData['Personal Loan'] || !formData['Housing Loan'] || !formData.Marital) {
                showToast('‚ö†Ô∏è Mohon lengkapi semua field!', 'warning');
                return;
            }
            
            // Loading state
            btn.disabled = true;
            btn.innerHTML = '<i class="fas fa-spinner fa-spin"></i> Memproses...';
            resultCard.classList.add('hidden');
            
            try {
                console.log('Sending prediction request:', formData);
                
                const response = await fetch('http://localhost:8000/predict', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify(formData)
                });
                
                if (!response.ok) {
                    const errorData = await response.json().catch(() => ({ detail: 'Unknown error' }));
                    throw new Error(errorData.detail || `HTTP ${response.status}`);
                }
                
                const result = await response.json();
                console.log('Prediction result:', result);
                
                // Display result
                displayPredictionResult(result);
                
                // Show success toast
                showToast('‚úÖ Prediksi berhasil!', 'success');
                
            } catch (error) {
                console.error('Prediction error:', error);
                showToast(`‚ùå Error: ${error.message}`, 'error');
            } finally {
                // Reset button
                btn.disabled = false;
                btn.innerHTML = '<i class="fas fa-brain"></i> Prediksi Sekarang';
            }
        });
        
        /**
         * Display prediction result with color-coded label
         */
        function displayPredictionResult(result) {
            const resultCard = document.getElementById('result-card');
            const scoreEl = document.getElementById('result-score');
            const labelEl = document.getElementById('result-label');
            const probabilityEl = document.getElementById('result-probability');
            const recommendationEl = document.getElementById('result-recommendation');
            
            // Update content
            scoreEl.textContent = (result.prediction_score * 100).toFixed(1) + '%';
            labelEl.textContent = result.label;
            probabilityEl.textContent = result.probability_percentage;
            recommendationEl.textContent = result.recommendation;
            
            // Color coding based on label
            labelEl.classList.remove('text-red-400', 'text-yellow-400', 'text-green-400');
            if (result.label === 'Hot Lead') {
                labelEl.classList.add('text-red-400');
            } else if (result.label === 'Warm Lead') {
                labelEl.classList.add('text-yellow-400');
            } else {
                labelEl.classList.add('text-green-400');
            }
            
            // Show card with animation
            resultCard.classList.remove('hidden');
            resultCard.style.animation = 'fadeIn 0.5s ease-in';
        }
    </script>
</body>
</html>